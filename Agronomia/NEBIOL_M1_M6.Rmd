---
title: "Análisis de las muestras de NEBIOL y extractos M1-M6"
output: html_notebook
---

```{r}
# Librerias
library(dplyr)
library(tidyr) 
library(readr) 
library(udunits2)
library(tidyverse)
library(car)
library(agricolae)
library(tidyverse)
library(ggplot2)
library(patchwork)
library(RColorBrewer)
library(ggbreak)
library(plotrix)
library(ggsignif)
library(paletteer)

# DATA
Longitud <- read.csv("~/CursoR/CursoRgit/Agronomia/Materiales/Longitud nebiol M1-M6.csv")

Laterales <- read.csv("~/CursoR/CursoRgit/Agronomia/Materiales/Laterales nebiol M1-M6.csv")

Bioensayo <- read.csv("~/CursoR/CursoRgit/Agronomia/Materiales/Bioensayo M1-M6_long_lateral.csv")

```

### Análisis para la variable longitud de raíz:

```{r}
# LOTE 1:
par(mfrow=c(1,2))
hist(Bioensayo$Longitud.Lote.1)
qqnorm(Bioensayo$Longitud.Lote.1)

shapiro.test(Bioensayo$Longitud.Lote.1)

# Normalización:
par(mfrow=c(1,2))
hist(log(Bioensayo$Longitud.Lote.1))
qqnorm(log(Bioensayo$Longitud.Lote.1))

shapiro.test(log(Bioensayo$Longitud.Lote.1))

kruskal.test(Longitud.Lote.1 ~ Tratamiento, data = Bioensayo)

pairwise.wilcox.test(Bioensayo$Longitud.Lote.1,
                     Bioensayo$Tratamiento,
                     p.adjust.method = "bonferroni")

# LOTE 2:
par(mfrow=c(1,2))
hist(Bioensayo$Longitud.Lote.2)
qqnorm(Bioensayo$Longitud.Lote.2)

shapiro.test(Bioensayo$Longitud.Lote.2)

# Normalización:
par(mfrow=c(1,2))
hist(log(Bioensayo$Longitud.Lote.2))
qqnorm(log(Bioensayo$Longitud.Lote.2))

shapiro.test(log(Bioensayo$Longitud.Lote.2))

kruskal.test(Longitud.Lote.2 ~ Tratamiento, data = Bioensayo)

pairwise.wilcox.test(Bioensayo$Longitud.Lote.2,
                     Bioensayo$Tratamiento,
                     p.adjust.method = "bonferroni")
```


### Análisis para la variable de raíces laterales:

```{r}
# Lote 1:
par(mfrow=c(1,2))
hist(Bioensayo$Laterales.Lote.1)
qqnorm(Bioensayo$Laterales.Lote.1)

shapiro.test(Bioensayo$Laterales.Lote.1)

# Normalización:
par(mfrow=c(1,2))
hist(log(Bioensayo$Laterales.Lote.1))
qqnorm(log(Bioensayo$Laterales.Lote.1))

shapiro.test(log(Bioensayo$Laterales.Lote.1))

kruskal.test(Laterales.Lote.1 ~ Tratamiento, data = Bioensayo)

pairwise.wilcox.test(Bioensayo$Laterales.Lote.1,
                     Bioensayo$Tratamiento,
                     p.adjust.method = "bonferroni")

# Lote 2:
par(mfrow=c(1,2))
hist(Bioensayo$Laterales.Lote.2)
qqnorm(Bioensayo$Laterales.Lote.2)

shapiro.test(Bioensayo$Laterales.Lote.2)

# Normalización:
par(mfrow=c(1,2))
hist(log(Bioensayo$Laterales.Lote.2))
qqnorm(log(Bioensayo$Laterales.Lote.2))

shapiro.test(log(Bioensayo$Laterales.Lote.2))

kruskal.test(Laterales.Lote.2 ~ Tratamiento, data = Bioensayo)

pairwise.wilcox.test(Bioensayo$Laterales.Lote.2,
                     Bioensayo$Tratamiento,
                     p.adjust.method = "bonferroni")
```

### Graficos del promedio de la longitud de raiz y raices laterales para Nebiol

```{r}
# Filtrar datos para solo obtener una tabla de los promedios de la longitud de raiz para el lote 1 y 2:

Promedios <- Bioensayo %>%
  group_by(Tratamiento) %>%
  summarize(Long_lote1 = mean(Longitud.Lote.1, na.rm = TRUE),
            Desv_est_L1 = sd(Longitud.Lote.1, na.rm = TRUE),
            Error_desv_est_L1 = std.error(Longitud.Lote.1, na.rm = TRUE),
            Long_lote2 = mean(Longitud.Lote.2, na.rm = TRUE),
            Desv_est_L2 = sd(Longitud.Lote.2, na.rm = TRUE),
            Error_desv_est_L2 = std.error(Longitud.Lote.2, na.rm = TRUE),
            Lat_lote1 = mean(ifelse(Laterales.Lote.1==0, NA, Laterales.Lote.1), na.rm = TRUE),
            Desv_lat_L1 = sd(ifelse(Laterales.Lote.1==0, NA, Laterales.Lote.1), na.rm = TRUE),
            Error_desv_lat_L1 = std.error(ifelse(Laterales.Lote.1==0, NA, Laterales.Lote.1), na.rm = TRUE),
            Lat_lote2 = mean(ifelse(Laterales.Lote.2==0, NA, Laterales.Lote.2), na.rm = TRUE),
            Desv_lat_L2 = sd(ifelse(Laterales.Lote.2==0, NA, Laterales.Lote.2), na.rm = TRUE),
            Error_desv_lat_L2 = std.error(ifelse(Laterales.Lote.2==0, NA, Laterales.Lote.2), na.rm = TRUE))

# Se acomodan los datos:

levels(Promedios$Tratamiento)
Promedios$Tratamiento=factor(Promedios$Tratamiento,levels=c("Control","NAA","GA3","M1 Directo", "M1 1:20","M1 1:50","M2 Directo", "M2 1:20","M2 1:50","M3 Directo","M3 1:20","M3 1:50", "M4 Directo","M4 1:20","M4 1:50", "M5 Directo", "M5 1:20", "M5 1:50", "M6 Directo", "M6 1:20", "M6 1:50"))
levels(Promedios$Tratamiento)

# Grafico de la longitud de raíz lote 1:

ggplot(Promedios)+
  theme_classic()+
  geom_col(aes(x = Tratamiento, y = Long_lote1, fill=Tratamiento))+
  ggtitle("Bioensayo de muestras de NEBIOL y extractos Lote #1")+
  theme(plot.title = element_text(hjust = 0.5, size = 15, color = "black", face = "bold"))+
  ylab("Longitud de raíz primaria")+
  theme(axis.text.x = element_text(angle=45,hjust=1))+
  theme(axis.title.y=element_text(vjust = 3))+
  scale_fill_manual(values=c("#BFB2FF","#8F7EE5","#6559CC","#260F99", "#260F99","#260F99","#0F6B99", "#0F6B99","#0F6B99", "#7EC3E5", "#7EC3E5", "#7EC3E5","#6B990F","#6B990F","#6B990F","#A3CC51" ,"#A3CC51","#A3CC51", "#C3E58E", "#C3E58E", "#C3E58E"))+
  theme(legend.position = "none")

# Grafico raices laterales para el lote 1:
ggplot(Promedios)+
  theme_classic()+
  geom_col(aes(x = Tratamiento, y = Lat_lote1, fill=Tratamiento))+
  ggtitle("Bioensayo de muestras de NEBIOL y extractos Lote #2")+
  theme(plot.title = element_text(hjust = 0.5, size = 15, color = "black", face = "bold"))+
  ylab("Raíces laterales")+
  theme(axis.text.x = element_text(angle=45,hjust=1))+
  theme(axis.title.y=element_text(vjust = 3))+
  scale_fill_manual(values=c("#BFB2FF","#8F7EE5","#6559CC","#260F99", "#260F99","#260F99","#0F6B99", "#0F6B99", "#7EC3E5", "#7EC3E5", "#7EC3E5","#6B990F","#6B990F","#6B990F","#A3CC51" ,"#A3CC51","#A3CC51", "#C3E58E", "#C3E58E", "#C3E58E"))+
  theme(legend.position = "none")

# Grafico de la longitud de raíz lote 2:

ggplot(Promedios)+
  theme_classic()+
  geom_col(aes(x = Tratamiento, y = Long_lote2, fill=Tratamiento))+
  ggtitle("Bioensayo de muestras de NEBIOL y extractos Lote #1")+
  theme(plot.title = element_text(hjust = 0.5, size = 15, color = "black", face = "bold"))+
  ylab("Longitud de raíz primaria")+
  theme(axis.text.x = element_text(angle=45,hjust=1))+
  theme(axis.title.y=element_text(vjust = 3))+
  scale_fill_manual(values=c("#BFB2FF","#8F7EE5","#6559CC","#260F99", "#260F99","#260F99","#0F6B99", "#0F6B99","#0F6B99", "#7EC3E5", "#7EC3E5", "#7EC3E5","#6B990F","#6B990F","#6B990F","#A3CC51" ,"#A3CC51","#A3CC51", "#C3E58E", "#C3E58E", "#C3E58E"))+
  theme(legend.position = "none")

# Grafico raices laterales para el lote 2:
ggplot(Promedios)+
  theme_classic()+
  geom_col(aes(x = Tratamiento, y = Lat_lote2, fill=Tratamiento))+
  ggtitle("Bioensayo de muestras de NEBIOL y extractos Lote #2")+
  theme(plot.title = element_text(hjust = 0.5, size = 15, color = "black", face = "bold"))+
  ylab("Raíces laterales")+
  theme(axis.text.x = element_text(angle=45,hjust=1))+
  theme(axis.title.y=element_text(vjust = 3))+
  scale_fill_manual(values=c("#BFB2FF","#8F7EE5","#6559CC","#260F99", "#260F99","#260F99","#0F6B99","#0F6B99", "#0F6B99", "#7EC3E5", "#7EC3E5", "#7EC3E5","#6B990F","#6B990F","#6B990F","#A3CC51" ,"#A3CC51","#A3CC51", "#C3E58E", "#C3E58E", "#C3E58E"))+
  theme(legend.position = "none")

```


```{r}
# Ambos lotes en un mismo gráfico para la variable de la longitud de raiz:

ggplot(Longitud,aes(x=Tratamiento, y = Longitud ,fill= Lote))+ 
  theme_bw()+
  geom_bar(stat= "summary", fun="mean", position="dodge")+
  theme(axis.text.x = element_text(angle=45,hjust=1))+
  scale_x_discrete(limits = c("Control","NAA","GA3","M1 Directo", "M1 1:20","M1 1:50","M2 Directo", "M2 1:20","M2 1:50","M3 Directo","M3 1:20","M3 1:50", "M4 Directo","M4 1:20","M4 1:50", "M5 Directo", "M5 1:20", "M5 1:50", "M6 Directo", "M6 1:20", "M6 1:50"))+
  scale_fill_manual(name = "# Lote", values = c("#00688B", "seagreen3"))


Prom <- Longitud %>%
  group_by(Tratamiento, Lote) %>%
  summarize(Longitud = mean(Longitud, na.rm = TRUE))

ggplot(Prom, aes(x = Tratamiento, y = Longitud, fill = Lote))+
  theme_bw()+
  geom_col( position = "dodge")+
  ggtitle("Bioensayo de muestras de NEBIOL y extractos")+
  theme(plot.title = element_text(hjust = 0.5, size = 15, color= "black", face = "bold"))+
  ylab("Longitud de raíz primaria")+
  scale_x_discrete(limits = c("Control","NAA","GA3","M1 Directo", "M1 1:20","M1 1:50","M2 Directo", "M2 1:20","M2 1:50","M3 Directo","M3 1:20","M3 1:50", "M4 Directo","M4 1:20","M4 1:50", "M5 Directo", "M5 1:20", "M5 1:50", "M6 Directo", "M6 1:20", "M6 1:50"))+
  theme(axis.text.x = element_text(angle=45,hjust=1))+
  theme(axis.title.y = element_text(vjust = 3))+
  scale_fill_manual(name = "# Lote",values = c("#00688B", "seagreen3"))
```

```{r}
# Ambos lotes en un mismo grafico para la variable de raices laterales:

Promlat <- Laterales %>%
  group_by(Tratamiento, Lote) %>%
  summarize(Media_laterales= mean(ifelse(Raices.laterales==0, NA, Raices.laterales), na.rm = TRUE))

ggplot(Promlat, aes(x = Tratamiento, y = Media_laterales, fill = Lote))+
  geom_col( position = "dodge")+
  theme_bw()+
  ggtitle("Bioensayo de muestras de NEBIOL y extractos")+
  theme(plot.title = element_text(hjust = 0.5, size = 15, color = "black", face = "bold"))+
  ylab("Raíces laterales")+
  scale_x_discrete(limits = c("Control","NAA","GA3","M1 Directo", "M1 1:20","M1 1:50","M2 Directo", "M2 1:20","M2 1:50","M3 Directo","M3 1:20","M3 1:50", "M4 Directo","M4 1:20","M4 1:50", "M5 Directo", "M5 1:20", "M5 1:50", "M6 Directo", "M6 1:20", "M6 1:50"))+
  theme(axis.text.x = element_text(angle=45,hjust=1))+
  theme(axis.title.y = element_text(vjust =3))+
  scale_fill_manual(name = "# Lote", values = c("#00688B", "seagreen3"))
```

